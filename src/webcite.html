<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real Estate System | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-[#0b0f1a] text-white font-sans">

<div class="flex h-screen">
    <div class="w-72 bg-[#161b2c] border-r border-gray-800 p-6 flex flex-col">
        <div class="mb-10 text-2xl font-black text-blue-500 italic">ASTANA REAL ESTATE </div>

        <nav id="sidebar-nav" class="space-y-2 flex-1">
            <button onclick="filterType('ALL')" class="w-full text-left p-3 rounded-xl transition bg-blue-600/10 border border-blue-500/50 text-blue-400">
                <i class="fas fa-layer-group mr-3"></i>All Properties
            </button>
            <button onclick="filterType('APARTMENT')" class="w-full text-left p-3 rounded-xl hover:bg-gray-800 transition border border-transparent">
                <i class="fas fa-building mr-3"></i>Apartments
            </button>
            <button onclick="filterType('HOUSE')" class="w-full text-left p-3 rounded-xl hover:bg-gray-800 transition border border-transparent">
                <i class="fas fa-home mr-3"></i>Houses
            </button>
        </nav>

        <div class="bg-blue-600 p-4 rounded-2xl shadow-lg shadow-blue-500/20">
            <p class="text-xs opacity-70 mb-1">System Status</p>
            <p class="font-bold">Backend Sync Active</p>
        </div>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="h-20 border-b border-gray-800 flex items-center justify-between px-10 bg-[#0b0f1a]/80 backdrop-blur">
            <div class="relative w-96">
                <i class="fas fa-search absolute left-4 top-3 text-gray-500"></i>
                <input id="search" type="text" placeholder="Search address..." class="w-full bg-gray-900 border border-gray-800 rounded-full py-2 pl-12 pr-4 focus:border-blue-500 outline-none">
            </div>
            <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-full font-bold flex items-center gap-2 transition">
                <i class="fas fa-plus"></i> Add New Property
            </button>
        </header>

        <main class="flex-1 overflow-y-auto p-10">
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8" id="grid">
            </div>
        </main>
    </div>
</div>

<div id="modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-[#161b2c] p-8 rounded-3xl w-[500px] border border-gray-700 shadow-2xl">
        <h2 class="text-2xl font-bold mb-6">New Property Entry</h2>
        <div class="space-y-4">
            <input id="f-addr" type="text" placeholder="Address (e.g. Dostyk 10)" class="w-full bg-gray-900 border border-gray-800 p-4 rounded-xl outline-none focus:border-blue-500">
            <div class="flex gap-4">
                <input id="f-price" type="number" placeholder="Price $" class="w-1/2 bg-gray-900 border border-gray-800 p-4 rounded-xl outline-none focus:border-blue-500">
                <input id="f-sqft" type="number" placeholder="Sq.Ft" class="w-1/2 bg-gray-900 border border-gray-800 p-4 rounded-xl outline-none focus:border-blue-500">
            </div>
            <select id="f-type" class="w-full bg-gray-900 border border-gray-800 p-4 rounded-xl outline-none focus:border-blue-500 capitalize">
                <option value="APARTMENT">Apartment</option>
                <option value="HOUSE">House</option>
            </select>
            <div class="flex gap-4 mt-6">
                <button onclick="closeModal()" class="flex-1 py-4 rounded-xl bg-gray-800 font-bold">Cancel</button>
                <button onclick="addProperty()" class="flex-1 py-4 rounded-xl bg-blue-600 font-bold hover:bg-blue-500 transition">Save to DB</button>
            </div>
        </div>
    </div>
</div>

<script>
    let props = [];

    async function load() {
        try {
            const r = await fetch('http://localhost:8080/api/properties');
            props = await r.json();
            render(props);
        } catch (e) {
            console.error("Server connection failed");
        }
    }

    function render(data) {
        const grid = document.getElementById('grid');
        grid.innerHTML = data.map(p => `
            <div class="bg-[#161b2c] p-6 rounded-3xl border border-gray-800 hover:border-blue-500 transition-all group relative">

                <button onclick="deleteProperty(${p.id})" class="absolute top-4 right-4 text-gray-600 hover:text-red-500 transition-colors z-20 p-2">
                    <i class="fas fa-trash-alt"></i>
                </button>

                <div class="absolute top-6 right-6 text-gray-700 group-hover:text-blue-500/20 transition -z-0">
                    <i class="fas ${p.type === 'HOUSE' ? 'fa-home' : 'fa-building'} text-6xl"></i>
                </div>

                <div class="bg-blue-500/10 text-blue-400 text-[10px] font-black px-3 py-1 rounded-full w-fit mb-4 italic tracking-widest uppercase relative z-10">
                    ${p.type}
                </div>

                <h3 class="text-xl font-bold mb-1 relative z-10">${p.address}</h3>
                <p class="text-gray-500 text-sm mb-6 inline-flex items-center"><i class="fas fa-vector-square mr-2"></i>${p.sqft} mÂ² Total Area</p>

                <div class="flex items-end justify-between border-t border-gray-800 pt-6 mt-2">
                    <div>
                        <p class="text-gray-500 text-[10px] uppercase font-bold tracking-tighter">Market Price</p>
                        <p class="text-2xl font-black text-emerald-400">$${p.price.toLocaleString()}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-gray-500 text-[10px] uppercase font-bold tracking-tighter italic">Calc. Tax</p>
                        <p class="text-lg font-bold text-orange-500">$${p.tax}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    async function addProperty() {
        const addr = document.getElementById('f-addr').value;
        const price = document.getElementById('f-price').value;
        const sqft = document.getElementById('f-sqft').value;

        if(!addr || !price || !sqft) return alert("Please fill all fields");

        const newItem = {
            id: Date.now(),
            type: document.getElementById('f-type').value,
            address: addr,
            price: parseInt(price),
            sqft: parseInt(sqft),
            tax: price * 0.01
        };

        await fetch('http://localhost:8080/api/properties', {
            method: 'POST',
            body: JSON.stringify(newItem)
        });

        closeModal();
        load();

        document.getElementById('f-addr').value = '';
        document.getElementById('f-price').value = '';
        document.getElementById('f-sqft').value = '';
    }
    async function deleteProperty(id) {
        if (confirm("Are you sure you want to delete this property?")) {
            try {
                const response = await fetch(`http://localhost:8080/api/properties?id=${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    load();
                } else {
                    alert("Delete failed on server");
                }
            } catch (error) {
                alert("Server error: " + error.message);
            }
        }
    }

    function openModal() { document.getElementById('modal').classList.remove('hidden'); }
    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    document.getElementById('search').addEventListener('input', (e) => {
        const f = props.filter(p => p.address.toLowerCase().includes(e.target.value.toLowerCase()));
        render(f);
    });

    function filterType(type) {
        if(type === 'ALL') render(props);
        else render(props.filter(p => p.type === type));

        const navButtons = document.querySelectorAll('nav button');

        navButtons.forEach(btn => {
            btn.classList.remove('bg-blue-600/10', 'border-blue-500/50', 'text-blue-400');
            btn.classList.add('hover:bg-gray-800');
        });

        const clickedBtn = event.currentTarget;
        clickedBtn.classList.add('bg-blue-600/10', 'border-blue-500/50', 'text-blue-400');
        clickedBtn.classList.remove('hover:bg-gray-800');
    }
    load();
</script>
</body>
</html>